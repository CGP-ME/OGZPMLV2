#!/usr/bin/env node

/**
 * build-claudito-context.js
 *
 * Concatenates the OGZPrime meta files into a single context file
 * for dropping into Claude/ChatGPT at the start of a session.
 *
 * Output: ogz-meta/claudito_context.md
 */

const fs = require("fs");
const path = require("path");

const META_DIR = __dirname;

const FILE_ORDER = [
  "00_intent.md",
  "01_purpose-and-vision.md",
  "02_architecture-overview.md",
  "03_modules-overview.md",
  "04_guardrails-and-rules.md",
  "05_landmines-and-gotchas.md",
  "06_recent-changes.md",
  "07_trey-brain-lessons.md",
];

const OUTPUT_FILE = "claudito_context.md";

function readIfExists(filePath) {
  if (!fs.existsSync(filePath)) {
    console.warn(`[WARN] Missing meta file: ${path.basename(filePath)} (skipping)`);
    return null;
  }
  return fs.readFileSync(filePath, "utf8");
}

function main() {
  console.log("üîß Building Claudito context pack...");

  let parts = [];

  for (const fileName of FILE_ORDER) {
    const fullPath = path.join(META_DIR, fileName);
    const content = readIfExists(fullPath);

    if (!content) continue;

    // Header separator between sections for readability in the final paste.
    parts.push(
      `\n\n---\n\n<!-- ${fileName} -->\n\n` + content.trim() + "\n"
    );
  }

  if (parts.length === 0) {
    console.error("‚ùå No meta files found. Nothing to build.");
    process.exit(1);
  }

  const outputPath = path.join(META_DIR, OUTPUT_FILE);
  const finalContent =
    "# OGZPrime ‚Äì Claudito Context Pack\n" +
    "_Autogenerated from ogz-meta/*.md ‚Äì do not edit this file directly._\n" +
    parts.join("");

  fs.writeFileSync(outputPath, finalContent, "utf8");

  console.log(`‚úÖ Built ${OUTPUT_FILE}`);
  console.log(`   Path: ${outputPath}`);
  console.log("\nNow open that file and slap it into Claude/ChatGPT to start a session.");
}

main();
