
# SUPPORT MISSION PLAN
Generated: 2025-12-25T23:36:01.398Z

## ISSUE
bot executing too many trades per second machine gunning orders

## TRIAGE RESULTS
- **Severity**: LOW
- **Category**: TRADING
- **Subsystems**: ExecutionLayer, MaxProfitManager
- **Containment**: 

## FORCED EVAL (COMMITMENT)
```
RAG_RETRIEVAL: YES - Must retrieve architecture and past fixes
FORENSICS: MAYBE - Similar issue found, may reuse fix
FIXER: NO
DEBUGGER: NO
TESTS: NO
DEPLOYMENT: NO
```

## SIMILAR PAST FIXES
- FIX-2025-12-25-TRAI-BLOCKING-MAIN-LOOP: - **File**: `run-empire-v2.js` lines 931-954
- FIX-2025-12-25-MAP-SERIALIZATION-FAILURE: - **File**: `core/StateManager.js` lines 326-385
- FIX-659-SUMMARY: Fixed feature data conversion in pattern pipeline

## RETRIEVED CONTEXT
# Retrieved Context

## Relevant Past Fixes:
- **FIX-2025-12-25-TRAI-BLOCKING-MAIN-LOOP**: - **File**: `run-empire-v2.js` lines 931-954
  - Root cause: - TRAI (AI decision system) blocked main loop for 2-5 seconds per decision
- During volatile moves, 
  - Files: run-empire-v2.js, core/StateManager.js
  - ✅ Worked: Bot never waits for TRAI decisions
- **FIX-2025-12-25-MAP-SERIALIZATION-FAILURE**: - **File**: `core/StateManager.js` lines 326-385
  - Root cause: - StateManager used Maps for activeTrades
- JavaScript Maps can't be serialized to JSON
- On restart
  - Files: core/StateManager.js, core/KrakenAdapterV2.js
  - ✅ Worked: Active trades persist across restarts
- **FIX-659-SUMMARY**: Fixed feature data conversion in pattern pipeline
  - Root cause: The pattern recording pipeline lost features data when converting from pattern objects to the record
  - Files: 
  - ✅ Worked: Preserving features array through pipeline
  - ❌ Failed: String signature truncation

## Relevant Reports:
### SURGICAL-FIXES-REPORT.md
  - `this.balance` property
  - `this.activeTrades` Map
- **Replaced ALL state references**:
  - `this.balance` → `stateManager.get('balance')` (12 replacements)
  - `this.activeTrades` → `stateManager.getAllTrades()` (5 replacements)
  - `this.activeTrades.set()` → `stateManager.updateActiveTrade()` (1 replacement)
  - `this.activeTrades.delete()` → `stateManager.removeActiveTrade()` (2 replacements)

### Impact
✅ StateManager is now the ONLY source of truth
✅ No more phantom trades or balance ...

### CLAUDITO_MISSION_LOG.md
- **File**: `core/EnhancedPatternRecognition.js:773-784`
- **Problem**: Only returned patterns when confidence > 0 (chicken & egg)
- **Solution**: Always return patterns with minimum 0.1 confidence
- **Result**: ✅ SUCCESS - Patterns now detected

#### FIX #3: Pattern Recording
- **File**: `run-empire-v2.js:741-760`
- **Problem**: Only recorded on trade completion (machine-gunning prevented this)
- **Solution**: Record immediately when patterns detected
- **Result**: ✅ SUCCESS - Patterns now save...

### FIX-659-SUMMARY.md
}
```

### 3. core/RiskManager.js (Line 1792)

**Pattern learning in trade completion:**
```javascript
// BEFORE
this.bot.patternRecognition.recordPatternResult(pattern.signature, {...})

// AFTER
const featuresForRecording = pattern.features || pattern.signature;
this.bot.patternRecognition.recordPatternResult(featuresForRecording, {...})
```

## Testing

### Before Testing
```bash
# Check pattern file before running bot...

## Architecture/Guardrails:
### From claudito_context.md:
 Upgrade Path

- **New Brains** (ML/quantum/neuromorphic)
  - Plug in at the **Signal/Brain** layer.
  - Must emit the standard decision schema used by ExecutionLayer.

- **New Brokers**
  - Implement a broker adapter that speaks:
    - `placeOrder`, `cancelOrder`, `getPositions`, `getBalance`, etc.
  - ExecutionLayer routes through the adapter instead of talking per-broker APIs directly....

### From 03_modules-overview.md:
03 — Modules Overview (OGZPrime Ecosystem Architecture)

(Structured from Trey’s design intent, mission, and raw system knowledge)

Overview

OGZPrime isn’t a single bot — it is a modular, extensible trading ecosystem built to be:

safe (no blown accounts)

stable (no disconnects, no silent failures)

transparent (no black-box ML lies)

adaptive (patterns, volatility, regimes)

upg...

### From 02_architecture-overview.md:
 Key Architectural Rules

- **Single Responsibility**
  - Each module has ONE main job (decision, execution, risk, learning, etc.).
  - If a file starts doing too many things, it’s a design smell.

- **Brain-Agnostic Execution**
  - ExecutionLayer should work with *any* brain that outputs the standard decision schema.
  - Brains can be swapped (classic, quantum, ML) without rewriting broke...



## ⚠️ USER VERIFICATION REQUIRED
**NO CHANGES WILL BE MADE AUTOMATICALLY**

This is a diagnostic report only. Review the analysis and suggested fixes below.
All changes require explicit user approval before implementation.

## SUGGESTED APPROACH
1. Known issue - see similar fixes below
2. **REVIEW**: User reviews suggested fixes from past issues
3. **APPROVE**: User selects which approach to take
4. **IMPLEMENT**: User or approved agent implements fix
5. **TEST**: Run smoke tests on affected subsystems
6. **DOCUMENT**: Update CHANGELOG and Fix Ledger

## RISK MAP TEMPLATE (FOR REFERENCE)
```javascript
{
  file: "path/to/file.js",
  line: 123,
  root_cause: "...",
  minimal_fix: "...",
  required_tests: ["smoke test X", "verify Y"],
  telemetry: ["monitor metric Z"]
}
```

## RULES
- NO action without context
- NO fixes without forensics Risk Map
- NO commits without tests
- EVERY fix updates the ledger

---
To proceed, run the mission chain with this plan as context.
