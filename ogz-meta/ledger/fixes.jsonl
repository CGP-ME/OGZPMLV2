{"id":"FIX-659-INDEX","date":"2025-12-25","severity":"HIGH","tags":["pattern-memory","recording"],"symptom":"Pattern memory not growing","root_cause":"See report","minimal_fix":"Fixed feature data conversion in pattern pipeline","files":["v2.js","v2.js","EnhancedPatternRecognition.js","RiskManager.js"],"verification":["Patterns now recording","Memory growing"],"outcome":"success","what_worked":["Preserving features array through pipeline"],"what_failed":["String signature truncation"],"evidence":["FIX-659-INDEX.md"],"commit":null}
{"id":"FIX-659-SUMMARY","date":"2025-12-25","severity":"HIGH","tags":["pattern-memory","recording"],"symptom":"Pattern memory was not growing despite hours of trading. The bot only showed the BASE_PATTERN despite processing hundreds of trades.","root_cause":"The pattern recording pipeline lost features data when converting from pattern objects to the recordPatternResult API:\n\n1. **analyzePatterns()** creates patterns with `features` field (numeric array)\n2. **recordPatternResult()** was called with `signature` field (truncated string)\n3. **recordPattern()** expects features array, not signature string\n4. Validation failed on signature string, patterns never stored","minimal_fix":"Fixed feature data conversion in pattern pipeline","files":[],"verification":["Patterns now recording","Memory growing"],"outcome":"success","what_worked":["Preserving features array through pipeline"],"what_failed":["String signature truncation"],"evidence":["FIX-659-SUMMARY.md"],"commit":null}
{"id":"FIX-2025-12-25-STATE-DESYNCHRONIZATION","date":"2025-12-25","severity":"CRITICAL","tags":["state"],"symptom":"- Three different sources of \"truth\" tracking the same data:","root_cause":"- Three different sources of \"truth\" tracking the same data:\n  - `this.currentPosition` in main bot (run-empire-v2.js)\n  - `this.tradingBrain.position` in OptimizedTradingBrain\n  - `this.executionLayer.positions` Map in AdvancedExecutionLayer\n- Each module updating its own copy â†’ phantom trades, balance mismatches\n- \"3 truths = 0 truth\" - complete state chaos","minimal_fix":"- **File**: `run-empire-v2.js` (multiple locations)","files":["run-empire-v2.js"],"verification":["StateManager is now the ONLY source of truth","No more phantom trades or balance mismatches","All modules read/write to same centralized state"],"outcome":"success","what_worked":["StateManager is now the ONLY source of truth","No more phantom trades or balance mismatches","All modules read/write to same centralized state"],"what_failed":[],"evidence":["SURGICAL-FIXES-REPORT.md#STATE DESYNCHRONIZATION"],"commit":null}
{"id":"FIX-2025-12-25-TRAI-BLOCKING-MAIN-LOOP","date":"2025-12-25","severity":"CRITICAL","tags":["trai","performance"],"symptom":"- TRAI (AI decision system) blocked main loop for 2-5 seconds per decision","root_cause":"- TRAI (AI decision system) blocked main loop for 2-5 seconds per decision\n- During volatile moves, bot was blind while waiting for AI to \"think\"\n- Flash crashes could happen while bot waited for philosophical analysis","minimal_fix":"- **File**: `run-empire-v2.js` lines 931-954","files":["run-empire-v2.js","core/StateManager.js"],"verification":["Bot never waits for TRAI decisions","Can react instantly to market moves","TRAI does post-trade learning only"],"outcome":"success","what_worked":["Bot never waits for TRAI decisions","Can react instantly to market moves","TRAI does post-trade learning only","Mathematical logic drives real-time decisions"],"what_failed":[],"evidence":["SURGICAL-FIXES-REPORT.md#TRAI BLOCKING MAIN LOOP"],"commit":null}
{"id":"FIX-2025-12-25-MAP-SERIALIZATION-FAILURE","date":"2025-12-25","severity":"CRITICAL","tags":["trai"],"symptom":"- StateManager used Maps for activeTrades","root_cause":"- StateManager used Maps for activeTrades\n- JavaScript Maps can't be serialized to JSON\n- On restart, all active trades were lost\n- Bot had amnesia after every restart","minimal_fix":"- **File**: `core/StateManager.js` lines 326-385","files":["core/StateManager.js","core/KrakenAdapterV2.js"],"verification":["Active trades persist across restarts","Bot remembers exact position after crash","No more lost trades on reboot"],"outcome":"success","what_worked":["Active trades persist across restarts","Bot remembers exact position after crash","No more lost trades on reboot","Automatic save after every state update"],"what_failed":[],"evidence":["SURGICAL-FIXES-REPORT.md#MAP SERIALIZATION FAILURE"],"commit":null}
{"id":"FIX-2025-12-25-KRAKEN-ADAPTER-ARCHITECTURE-MI","date":"2025-12-25","severity":"CRITICAL","tags":[],"symptom":"- kraken_adapter_simple.js works but doesn't implement IBrokerAdapter interface","root_cause":"- kraken_adapter_simple.js works but doesn't implement IBrokerAdapter interface\n- System expects v2 architecture with 30+ standard methods\n- \"Running a Ferrari off a matchbox car engine\"","minimal_fix":"- **File**: `core/KrakenAdapterV2.js` (NEW FILE - 322 lines)","files":["core/KrakenAdapterV2.js","kraken_adapter_simple.js"],"verification":["Full IBrokerAdapter compliance","Position tracking via StateManager","Account polling (compensates for no private WebSocket)"],"outcome":"success","what_worked":["Full IBrokerAdapter compliance","Position tracking via StateManager","Account polling (compensates for no private WebSocket)","Working solution now, native rewrite later"],"what_failed":[],"evidence":["SURGICAL-FIXES-REPORT.md#KRAKEN ADAPTER ARCHITECTURE MISMATCH"],"commit":null}
{"id":"FIX-2025-12-25-RECURSIVE-RATE-LIMITER-STACK-O","date":"2025-12-25","severity":"CRITICAL","tags":["rate-limit"],"symptom":"- Rate limiter used recursion for retries","root_cause":"- Rate limiter used recursion for retries\n- On 429 errors, created infinite promise chain\n- Stack overflow after ~1000 rate limit hits\n- Memory leak from accumulated promises","minimal_fix":"- **File**: `kraken_adapter_simple.js` lines 109-204","files":["kraken_adapter_simple.js","run-empire-v2.js"],"verification":["No more stack overflow on rate limits","No more promise accumulation/memory leak","Clean queue-based retry mechanism"],"outcome":"success","what_worked":["No more stack overflow on rate limits","No more promise accumulation/memory leak","Clean queue-based retry mechanism","Processes queue every 100ms when active"],"what_failed":[],"evidence":["SURGICAL-FIXES-REPORT.md#RECURSIVE RATE LIMITER STACK OVERFLOW"],"commit":null}
{"id":"FIX-2026-02-05-DEEPSEARCH-001-BUY-DIRECTION","date":"2026-02-05","severity":"CRITICAL","tags":["signals","execution","profitability"],"symptom":"Bot buying on bearish/hold brain signals - ~50% of positions opened against brain direction","root_cause":"makeTradeDecision() line 1908 only checked `pos === 0 && totalConfidence >= minConfidence` without verifying brainDirection === 'buy'. Brain could say 'sell' or 'hold' and bot would still open a long position.","minimal_fix":"Added `&& brainDirection === 'buy'` to BUY condition at run-empire-v2.js:1908","files":["run-empire-v2.js"],"verification":["Backtest pending - expect ~50% fewer trades but much higher win rate"],"outcome":"pending","what_worked":[],"what_failed":[],"evidence":["Sourcegraph DeepSearch 2026-02-05","FORENSIC_011"],"commit":null}
{"id":"FIX-2026-02-05-DEEPSEARCH-002-EXIT-PARTIAL","date":"2026-02-05","severity":"CRITICAL","tags":["exits","maxprofit","profitability"],"symptom":"MaxProfitManager tiered profit exits completely dead - exit_partial action silently ignored","root_cause":"run-empire-v2.js:2082 only checked `profitResult.action === 'exit' || profitResult.action === 'exit_full'`. MaxProfitManager returns 'exit_partial' for tier hits (line 440) - this action was silently dropped.","minimal_fix":"Added `|| profitResult.action === 'exit_partial'` to the exit check at run-empire-v2.js:2082. Also passes exitSize in return for partial position closing.","files":["run-empire-v2.js"],"verification":["Backtest pending - expect tiered exits to fire on profitable positions"],"outcome":"pending","what_worked":[],"what_failed":[],"evidence":["Sourcegraph DeepSearch 2026-02-05","FORENSIC_002"],"commit":null}
{"id":"FIX-2026-02-05-DEEPSEARCH-003-FEE-DEDUCTION","date":"2026-02-05","severity":"HIGH","tags":["fees","math","profitability"],"symptom":"Fees never deducted from balance - P&L overstated by ~108%, backtest results unreliable","root_cause":"StateManager.openPosition() and closePosition() moved USD in/out without deducting Kraken trading fees (0.26% per side). All P&L calculations were fee-blind.","minimal_fix":"Added 0.26% fee deduction on both entry (openPosition line 316) and exit (closePosition line 400) in StateManager.js","files":["core/StateManager.js"],"verification":["Backtest pending - expect lower raw P&L but accurate real-world numbers"],"outcome":"pending","what_worked":[],"what_failed":[],"evidence":["Sourcegraph DeepSearch 2026-02-05","FORENSIC_003"],"commit":null}
{"id":"FIX-2026-02-05-DEEPSEARCH-004-BACKTEST-TIME","date":"2026-02-05","severity":"HIGH","tags":["backtest","time","exits"],"symptom":"holdTime calculations used Date.now() instead of candle timestamps - all hold times ~0 in backtest, time-based exits broken","root_cause":"6 locations in run-empire-v2.js used Date.now() for entryTime recording and holdTime/holdDuration calculations. In backtest mode, Date.now() is wall clock time not simulated candle time, so hold durations were microseconds instead of minutes. Time-based exits (30min stale trade, min hold time) were completely inverted.","minimal_fix":"Replaced Date.now() with `this.marketData?.timestamp || Date.now()` at lines 2090, 2134, 2320, 2432, 2522, 2528. Passed candle timestamp via context to StateManager.openPosition().","files":["run-empire-v2.js"],"verification":["Backtest pending - expect correct holdTime values, 30min stale exit to fire properly"],"outcome":"pending","what_worked":[],"what_failed":[],"evidence":["Sourcegraph DeepSearch 2026-02-05","FORENSIC_004"],"commit":null}
{"id":"FIX-2026-02-05-DEEPSEARCH-005-BREAKEVEN-BUFFER","date":"2026-02-05","severity":"MEDIUM","tags":["exits","maxprofit","fees"],"symptom":"Breakeven stop triggered guaranteed losses - fee buffer 0.1% vs actual 0.32% round-trip fees","root_cause":"MaxProfitManager.js:730 set feeBuffer = 0.001 (0.1%). Kraken round-trip fees are 0.52% (0.26% x 2 sides). 'Breakeven' stop was actually locking in a -0.22% loss every time it triggered.","minimal_fix":"Changed feeBuffer from 0.001 to 0.0035 at MaxProfitManager.js:730","files":["core/MaxProfitManager.js"],"verification":["Backtest pending - expect breakeven stops to actually break even"],"outcome":"pending","what_worked":[],"what_failed":[],"evidence":["Sourcegraph DeepSearch 2026-02-05","FORENSIC_008"],"commit":null}
